# Docker on Travis requires sudo.
sudo: required

services:
  - docker

script:
  - bash build.sh

after_success:
  - docker login -u $DOCKER_USER -p $DOCKER_PASS
  - >
      if [ "$TRAVIS_EVENT_TYPE" == "pull_request" ]; then
        echo "PR!";
      fi

  - >
      if [ ! -z "$TRAVIS_TAG" ]; then
        echo "Tagged $TRAVIS_TAG!";
        docker tag image $REPO:$TRAVIS_TAG;
      fi

after_script:
  - docker logs higlass-container
  - docker tag image $REPO:$BRANCH && docker push $REPO:$BRANCH
  # Always push to the branch tag, at least, so that it's cached for the next run:
  # Even if this failed, it will save time to download the earlier layers,
  # rather than rebuilding them.