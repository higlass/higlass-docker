# Docker on Travis requires sudo.
sudo: required

install:
  - DEB=docker-engine_1.13.0-0~ubuntu-precise_amd64.deb
  - wget https://apt.dockerproject.org/repo/pool/main/d/docker-engine/$DEB
  - sudo dpkg -i $DEB
  - sudo docker run hello-world
  - sudo docker --version
  - docker run hello-world
  - exit 1
#  - sudo apt-get update
#  - sudo apt-get install docker-engine
#  # TODO: pin version
#  - sudo dbpk -s docker-engine

script:
  - ./build.sh

after_success:
  - docker login -u $DOCKER_USER -p $DOCKER_PASS
  - >
      if [ "$TRAVIS_EVENT_TYPE" == "pull_request" ]; then
        echo "PR!"
      fi

  - >
      if [ ! -z "$TRAVIS_TAG" ]; then
        echo "Tagged $TRAVIS_TAG!"
        docker tag image $REPO:$TRAVIS_TAG
        docker push $REPO:$TRAVIS_TAG
      fi

  - >
      docker tag image $REPO
      docker push $REPO
